# 腾讯云操作

## 服务器信息
- 服务器IP：43.136.121.50
- SSH连接：`ssh ubuntu@43.136.121.50`

## 项目目录
```bash
cd /root/NHANES_WEB
```

## 服务操作步骤

### 1. 切换到root用户
```bash
sudo su
```

### 2. 停止所有服务
```bash
# 停止nginx
sudo systemctl stop nginx

# 停止后端Flask服务
sudo supervisorctl stop nhanes-backend
```

### 3. 启动服务

#### 启动前端服务（nginx）
```bash
# 启动nginx
sudo systemctl start nginx

# 停止nginx
sudo systemctl stop nginx

# 重启nginx
sudo systemctl restart nginx

# 查看nginx状态
sudo systemctl status nginx

# 查看nginx错误日志
sudo tail -f /var/log/nginx/error.log

# 查看nginx访问日志
sudo tail -f /var/log/nginx/access.log
```

#### 启动后端服务
```bash
# 进入后端目录
cd /root/NHANES_WEB/backend

# 激活Python虚拟环境
source nhanes/bin/activate

# 启动后端Flask服务
sudo supervisorctl start nhanes-backend

# 停止后端Flask服务
sudo supervisorctl stop nhanes-backend

# 重启后端服务
sudo supervisorctl restart nhanes-backend

# 查看后端状态
sudo supervisorctl status nhanes-backend

# 查看后端日志（确认是否正常启动）
sudo tail -f /var/log/nhanes-backend.log
```

### 4. 服务异常处理

#### nginx异常处理
```bash
# 检查nginx配置是否正确
sudo nginx -t

# 重新加载nginx配置
sudo nginx -s reload

# 完全重启nginx
sudo systemctl restart nginx
```

#### 后端服务异常处理
```bash
# 重新加载supervisor配置
sudo supervisorctl reread
sudo supervisorctl update

# 检查后端进程
ps aux | grep python

# 检查后端API是否响应
curl http://localhost:5000/health
```

### 5. 文件路径说明
- nginx配置文件：`/etc/nginx/conf.d/nhanes.conf`
- supervisor配置文件：`/etc/supervisor/conf.d/nhanes-backend.conf`
- 后端日志文件：`/var/log/nhanes-backend.log`
- 项目目录：`/root/NHANES_WEB`
- 前端目录：`/root/NHANES_WEB/frontend`
- 后端目录：`/root/NHANES_WEB/backend`

### 6. 常见问题处理
1. 如果前端访问404：检查nginx配置和前端构建文件是否存在
2. 如果后端API无响应：检查后端日志和supervisor状态
3. 如果数据接口报错：检查后端日志和数据文件是否存在

### 7. 完整重启流程
```bash
# 1. 停止所有服务
sudo systemctl stop nginx
sudo supervisorctl stop nhanes-backend

# 2. 检查进程是否完全停止
ps aux | grep nginx
ps aux | grep python

# 3. 启动服务
sudo systemctl start nginx
sudo supervisorctl start nhanes-backend

# 4. 检查服务状态
sudo systemctl status nginx
sudo supervisorctl status nhanes-backend

# 5. 检查日志确认无错误
sudo tail -f /var/log/nginx/error.log
sudo tail -f /var/log/nhanes-backend.log
```